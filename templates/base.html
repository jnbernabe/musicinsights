<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Music Insights</title>

    {% if GOOGLE_ANALYTICS_ID %}
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "{{ GOOGLE_ANALYTICS_ID }}");
    </script>
    {% endif %}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    {% load static %}
    <link
      rel="icon"
      type="image/png"
      href="{% static 'musicinsights/img/favicon.png' %}"
    />
    <link rel="stylesheet" href="{% static 'musicinsights/css/style.css' %}" />
  </head>

  <body>
    <div class="app-container">
      <!-- Top Navbar -->
      <header class="top-navbar">
        <a href="/" class="brand">
          <i class="ph ph-music-notes-simple"></i>
          <h1>Music Insights</h1>
        </a>

        <div class="nav-center">
          {% block header_content %}
          <!-- Default or Empty if not overridden -->
          {% endblock %}
        </div>

        <div class="nav-actions">
          <!-- History Dropdown -->
          {% if recent_uploads %}
          <div class="dropdown">
            <button class="btn-ghost">
              <i class="ph ph-clock-counter-clockwise"></i> History
              <i class="ph ph-caret-down"></i>
            </button>
            <div class="dropdown-content">
              <div
                style="
                  padding: 4px 12px 8px;
                  font-size: 0.75rem;
                  text-transform: uppercase;
                  color: var(--text-muted);
                  letter-spacing: 0.05em;
                  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                  margin-bottom: 4px;
                "
              >
                Recent Dashboards
              </div>
              {% for dash in recent_uploads %}
              <div style="display: flex; align-items: center; gap: 4px">
                <a
                  href="{% url 'dashboard' dash.id %}"
                  class="history-item {% if current_playlist_id == dash.id %}active{% endif %}"
                  title="{{ dash.name }}"
                  style="flex: 1"
                >
                  <span class="history-item-name">{{ dash.name }}</span>
                </a>
                <a
                  href="{% url 'delete_history' dash.id %}"
                  style="
                    color: var(--text-muted);
                    padding: 8px;
                    border-radius: 6px;
                    transition: all 0.2s;
                    opacity: 0.5;
                  "
                  onmouseover="this.style.opacity='1'; this.style.color='#ff4444'; this.style.backgroundColor='rgba(255, 68, 68, 0.1)'"
                  onmouseout="this.style.opacity='0.5'; this.style.color='var(--text-muted)'; this.style.backgroundColor='transparent'"
                  title="Delete"
                >
                  <i class="ph ph-trash"></i>
                </a>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Global Actions -->
          <a
            href="{% url 'upload_file' %}"
            class="btn"
            style="padding: 8px 16px; font-size: 0.85rem"
          >
            <i class="ph ph-upload-simple"></i> Upload New CSV
          </a>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">{% block content %} {% endblock %}</main>
    </div>

    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    {% block scripts %} {% endblock %}
  </body>
</html>
